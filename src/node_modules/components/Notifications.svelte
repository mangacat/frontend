{#each toasts as { id, message, theme }, _ (id)}
    <div transition:slidefade class="fixed inset-x-0 top-0 mt-10 inline-flex rounded items-center text-sm font-bold px-4 py-3 mx-auto max-w-sm border-2 leading-none {themes[theme].container.class}" style="z-index: {100 + id}" role="alert">
		<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="fill-current w-6 h-6 mr-2">
			<path {...themes[theme].svg.primary} d="M12 2a10 10 0 1 1 0 20 10 10 0 0 1 0-20z" />
			<path {...themes[theme].svg.secondary} />
		</svg>
        <p>{message}</p>
    </div>
{/each}

<script>
	import { cubicOut } from 'svelte/easing'

	let count = 0
	let toasts = []
	const themes = {
		warning: {
			container: {
				class: 'bg-orange-100 text-orange-700 border-orange-200'
			},
			svg: {
				primary: {
					class: 'text-orange-400'
				},
				secondary: {
					class: 'text-orange-100',
					d: 'M12 18a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm1-5.9c-.13 1.2-1.88 1.2-2 0l-.5-5a1 1 0 0 1 1-1.1h1a1 1 0 0 1 1 1.1l-.5 5z'
				}
			}
		},
		success: {
			container: {
				class: 'bg-green-100 text-green-700 border-green-200'
			},
			svg: {
				primary: {
					class: 'text-green-400'
				},
				secondary: {
					class: 'text-green-100',
					d: 'M10 14.59l6.3-6.3a1 1 0 0 1 1.4 1.42l-7 7a1 1 0 0 1-1.4 0l-3-3a1 1 0 0 1 1.4-1.42l2.3 2.3z'
				}
			}
		},
		error: {
			container: {
				class: 'bg-red-100 text-red-700 border-red-200'
			},
			svg: {
				primary: {
					class: 'text-red-400'
				},
				secondary: {
					class: 'text-red-100',
					d: 'M13.41 12l2.83 2.83a1 1 0 0 1-1.41 1.41L12 13.41l-2.83 2.83a1 1 0 1 1-1.41-1.41L10.59 12 7.76 9.17a1 1 0 0 1 1.41-1.41L12 10.59l2.83-2.83a1 1 0 0 1 1.41 1.41L13.41 12z'
				}
			}
		},
		info: {
			container: {
				class: 'bg-blue-100 text-blue-700 border-blue-200'
			},
			svg: {
				primary: {
					class: 'text-blue-400'
				},
				secondary: {
					class: 'text-blue-100',
					d: 'M11 12a1 1 0 0 1 0-2h2a1 1 0 0 1 .96 1.27L12.33 17H13a1 1 0 0 1 0 2h-2a1 1 0 0 1-.96-1.27L11.67 12H11zm2-4a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3z'
				}
			}
		},
	}

	setInterval(() => {
		const currentTime = Date.now()
		toasts = toasts.filter(({ time, timeout }) => currentTime < time + timeout)
	}, 500)

	function slidefade(node, { delay = 0, duration = 400, easing = cubicOut }) {
		const style = getComputedStyle(node)
		const opacity = +style.opacity
		const margin_top = parseFloat(style.marginTop)

		return {
			delay,
			duration,
			easing,
			css: t => `opacity: ${t * opacity};` + `margin-top: ${t * margin_top}px;`
		}
	}

	function createToast (message, timeout, theme) {
		toasts = [{
			id: count,
			message,
			time: Date.now(),
			timeout,
			theme
		}, ...toasts]
		count += 1
	}

	function show (message, timeout = 3000, theme) {
		createToast(message, timeout, theme)
	}

	export function error (message, timeout) {
		show(message, timeout, 'error')
	}

	export function warning (message, timeout) {
		show(message, timeout, 'warning')
	}

	export function info (message, timeout) {
		show(message, timeout, 'info')
	}

	export function success (message, timeout) {
		show(message, timeout, 'success')
	}
</script>